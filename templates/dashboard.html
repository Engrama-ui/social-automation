<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard - Social Media Automation</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .help-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 4px;
        }
        .form-section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="flex items-center">
                        <i class="fas fa-robot text-2xl text-blue-600 mr-3"></i>
                        <h1 class="text-xl font-bold text-gray-800">Dashboard</h1>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/help" class="text-orange-600 hover:text-orange-800">
                        <i class="fas fa-question-circle mr-1"></i>Aiuto
                    </a>
                    <a href="/docs" class="text-blue-600 hover:text-blue-800">API Docs</a>
                    <a href="/" class="text-gray-600 hover:text-gray-800">Home</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Dashboard Automazione Social Media</h1>
            <p class="text-gray-600">Gestisci i tuoi contenuti, programma i post e monitora l'engagement in un unico posto</p>
        </div>

        <!-- Quick Actions Section -->
        <div class="form-section mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">
                <i class="fas fa-rocket text-blue-600 mr-2"></i>
                Azioni Rapide
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <button onclick="showSection('create-post')" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                    <i class="fas fa-plus mr-2"></i>Crea Nuovo Post
                </button>
                <button onclick="showSection('schedule-post')" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">
                    <i class="fas fa-calendar mr-2"></i>Programma Post
                </button>
                <button onclick="showSection('analytics')" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition duration-200">
                    <i class="fas fa-chart-bar mr-2"></i>Visualizza Analytics
                </button>
                <button onclick="showSection('account-config')" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition duration-200">
                    <i class="fas fa-cog mr-2"></i>Configura Account
                </button>
            </div>
        </div>

        <!-- Create Post Section -->
        <div id="create-post" class="form-section hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-edit text-blue-600 mr-2"></i>
                Crea Nuovo Post
            </h3>
            <form onsubmit="createPost(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Testo del Post
                            <span class="tooltip">
                                <i class="fas fa-question-circle text-gray-400 ml-1"></i>
                                <span class="tooltiptext">Scrivi il contenuto principale del tuo post. Usa hashtag (#) e mention (@) per aumentare l'engagement</span>
                            </span>
                        </label>
                        <textarea 
                            id="post-content" 
                            rows="4" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Cosa vuoi condividere oggi? Usa hashtag come #marketing #socialmedia"
                            required
                        ></textarea>
                        <div class="help-text">üí° Tip: I post con 1-3 hashtag ottengono pi√π engagement</div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Piattaforme
                            <span class="tooltip">
                                <i class="fas fa-question-circle text-gray-400 ml-1"></i>
                                <span class="tooltiptext">Seleziona su quali social network pubblicare questo contenuto</span>
                            </span>
                        </label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="platforms" value="facebook" class="mr-2">
                                <i class="fab fa-facebook text-blue-600 mr-2"></i>Facebook
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="platforms" value="twitter" class="mr-2">
                                <i class="fab fa-twitter text-blue-400 mr-2"></i>Twitter/X
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="platforms" value="instagram" class="mr-2">
                                <i class="fab fa-instagram text-pink-600 mr-2"></i>Instagram
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="platforms" value="linkedin" class="mr-2">
                                <i class="fab fa-linkedin text-blue-700 mr-2"></i>LinkedIn
                            </label>
                        </div>
                        <div class="help-text">üì± Seleziona almeno una piattaforma per pubblicare</div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Media (Opzionale)
                        <span class="tooltip">
                            <i class="fas fa-question-circle text-gray-400 ml-1"></i>
                            <span class="tooltiptext">Carica immagini o video per rendere il tuo post pi√π accattivante. Formati supportati: JPG, PNG, MP4</span>
                        </span>
                    </label>
                    <input 
                        type="file" 
                        id="media-upload" 
                        accept="image/*,video/*" 
                        multiple
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                    <div class="help-text">üñºÔ∏è I post con immagini ricevono il 650% in pi√π di engagement</div>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="hideSection('create-post')" class="mr-3 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                        Annulla
                    </button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                        <i class="fas fa-paper-plane mr-2"></i>Pubblica Ora
                    </button>
                </div>
            </form>
        </div>

        <!-- Schedule Post Section -->
        <div id="schedule-post" class="form-section hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-calendar-alt text-green-600 mr-2"></i>
                Programma Post
            </h3>
            <form onsubmit="schedulePost(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Data e Ora di Pubblicazione
                            <span class="tooltip">
                                <i class="fas fa-question-circle text-gray-400 ml-1"></i>
                                <span class="tooltiptext">Scegli quando pubblicare il post. Gli orari migliori sono 9-11 e 19-21</span>
                            </span>
                        </label>
                        <input 
                            type="datetime-local" 
                            id="schedule-datetime"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                            required
                        >
                        <div class="help-text">‚è∞ Orari consigliati: Luned√¨-Venerd√¨ 9-11, 19-21</div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Template Post
                            <span class="tooltip">
                                <i class="fas fa-question-circle text-gray-400 ml-1"></i>
                                <span class="tooltiptext">Scegli un template predefinito o crea contenuto personalizzato</span>
                            </span>
                        </label>
                        <select 
                            id="post-template"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                            onchange="loadTemplate()"
                        >
                            <option value="">Seleziona un template...</option>
                            <option value="promo">üéØ Post Promozionale</option>
                            <option value="education">üìö Contenuto Educativo</option>
                            <option value="engagement">üí¨ Post di Engagement</option>
                            <option value="custom">‚úèÔ∏è Contenuto Personalizzato</option>
                        </select>
                        <div class="help-text">üìù I template ti aiutano a creare contenuti efficaci</div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Anteprima Contenuto</label>
                    <div id="template-preview" class="w-full p-4 border border-gray-300 rounded-md bg-gray-50 min-h-24">
                        <span class="text-gray-500">Seleziona un template per vedere l'anteprima</span>
                    </div>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="hideSection('schedule-post')" class="mr-3 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                        Annulla
                    </button>
                    <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                        <i class="fas fa-clock mr-2"></i>Programma Post
                    </button>
                </div>
            </form>
        </div>

        <!-- Analytics Section -->
        <div id="analytics" class="form-section hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-chart-line text-purple-600 mr-2"></i>
                Analytics e Metriche
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-eye text-blue-600 text-xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600">Visualizzazioni Totali</p>
                            <p class="text-2xl font-bold text-blue-600" id="total-views">--</p>
                        </div>
                    </div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-heart text-green-600 text-xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600">Engagement Rate</p>
                            <p class="text-2xl font-bold text-green-600" id="engagement-rate">--</p>
                        </div>
                    </div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-users text-purple-600 text-xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600">Nuovi Follower</p>
                            <p class="text-2xl font-bold text-purple-600" id="new-followers">--</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-gray-900 mb-3">Engagement nel Tempo</h4>
                    <canvas id="engagement-chart" height="200"></canvas>
                </div>
                <div>
                    <h4 class="font-medium text-gray-900 mb-3">Top Post Questa Settimana</h4>
                    <div id="top-posts" class="space-y-3">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Configuration Section -->
        <div id="account-config" class="form-section hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-cog text-orange-600 mr-2"></i>
                Configurazione Account
            </h3>
            
            <!-- Connected Platforms -->
            <div class="mb-6">
                <h4 class="text-md font-medium text-gray-800 mb-3">
                    <i class="fas fa-share-alt text-blue-600 mr-2"></i>
                    Piattaforme Social Collegate
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Facebook -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fab fa-facebook text-blue-600 text-2xl mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-gray-900">Facebook</h5>
                                    <p class="text-sm text-gray-500" id="facebook-status">Non collegato</p>
                                </div>
                            </div>
                            <button onclick="connectPlatform('facebook')" id="facebook-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm">
                                Collega
                            </button>
                        </div>
                    </div>
                    
                    <!-- Instagram -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fab fa-instagram text-pink-600 text-2xl mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-gray-900">Instagram</h5>
                                    <p class="text-sm text-gray-500" id="instagram-status">Non collegato</p>
                                </div>
                            </div>
                            <button onclick="connectPlatform('instagram')" id="instagram-btn" class="bg-pink-600 text-white px-4 py-2 rounded-md hover:bg-pink-700 text-sm">
                                Collega
                            </button>
                        </div>
                    </div>
                    
                    <!-- Twitter -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fab fa-twitter text-blue-400 text-2xl mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-gray-900">Twitter/X</h5>
                                    <p class="text-sm text-gray-500" id="twitter-status">Non collegato</p>
                                </div>
                            </div>
                            <button onclick="connectPlatform('twitter')" id="twitter-btn" class="bg-blue-400 text-white px-4 py-2 rounded-md hover:bg-blue-500 text-sm">
                                Collega
                            </button>
                        </div>
                    </div>
                    
                    <!-- LinkedIn -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fab fa-linkedin text-blue-700 text-2xl mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-gray-900">LinkedIn</h5>
                                    <p class="text-sm text-gray-500" id="linkedin-status">Non collegato</p>
                                </div>
                            </div>
                            <button onclick="connectPlatform('linkedin')" id="linkedin-btn" class="bg-blue-700 text-white px-4 py-2 rounded-md hover:bg-blue-800 text-sm">
                                Collega
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                    <div class="flex">
                        <i class="fas fa-info-circle text-blue-500 mr-2 mt-1"></i>
                        <div>
                            <h5 class="text-sm font-medium text-blue-800">Come collegare un account social</h5>
                            <p class="text-sm text-blue-700 mt-1">
                                Per collegare un account social, avrai bisogno dei token di accesso API. 
                                Consulta la nostra <a href="/guide" class="underline">guida passo-passo</a> 
                                per istruzioni dettagliate.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Account Settings -->
            <div class="mb-6">
                <h4 class="text-md font-medium text-gray-800 mb-3">
                    <i class="fas fa-user-cog text-green-600 mr-2"></i>
                    Impostazioni Profilo
                </h4>
                <form onsubmit="saveAccountSettings(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Utente</label>
                            <input 
                                type="text" 
                                id="username" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                                placeholder="Il tuo nome utente"
                                value="Utente Demo"
                            >
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input 
                                type="email" 
                                id="email" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                                placeholder="tua-email@esempio.com"
                                value="demo@esempio.com"
                            >
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Fuso Orario</label>
                            <select 
                                id="timezone" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                            >
                                <option value="Europe/Rome" selected>Europa/Roma (CEST)</option>
                                <option value="Europe/London">Europa/Londra (GMT)</option>
                                <option value="America/New_York">America/New York (EST)</option>
                                <option value="America/Los_Angeles">America/Los Angeles (PST)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Lingua</label>
                            <select 
                                id="language" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                            >
                                <option value="it" selected>Italiano</option>
                                <option value="en">English</option>
                                <option value="es">Espa√±ol</option>
                                <option value="fr">Fran√ßais</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Notification Preferences -->
                    <div class="mt-6">
                        <h5 class="text-sm font-medium text-gray-800 mb-3">
                            <i class="fas fa-bell text-blue-600 mr-2"></i>
                            Preferenze Notifiche
                        </h5>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-3" checked>
                                <span class="text-sm text-gray-700">Notifiche email per post pubblicati</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-3" checked>
                                <span class="text-sm text-gray-700">Notifiche per engagement elevato</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-3">
                                <span class="text-sm text-gray-700">Reportistica settimanale via email</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-3">
                                <span class="text-sm text-gray-700">Suggerimenti di ottimizzazione</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex justify-end mt-6">
                        <button type="button" onclick="hideSection('account-config')" class="mr-3 px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50">
                            Annulla
                        </button>
                        <button type="submit" class="px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700">
                            <i class="fas fa-save mr-2"></i>Salva Impostazioni
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="form-section">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-clock text-gray-600 mr-2"></i>
                Attivit√† Recente
            </h3>
            <div id="recent-activity" class="space-y-3">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Manage Social Accounts Section -->
        <div class="form-section">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Gestione Account Social</h2>
            <p class="text-gray-600 mb-4">Collega o scollega i tuoi account social per iniziare a pubblicare contenuti.</p>
            <div class="space-y-4">
                <button onclick="connectPlatform('facebook')" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                    <i class="fab fa-facebook mr-2"></i>Collega Facebook
                </button>
                <button onclick="disconnectPlatform('facebook')" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                    <i class="fab fa-facebook mr-2"></i>Scollega Facebook
                </button>
                <button onclick="connectPlatform('instagram')" class="bg-pink-600 text-white px-4 py-2 rounded-md hover:bg-pink-700">
                    <i class="fab fa-instagram mr-2"></i>Collega Instagram
                </button>
                <button onclick="disconnectPlatform('instagram')" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">
                    <i class="fab fa-instagram mr-2"></i>Scollega Instagram
                </button>
                <!-- Add buttons for other platforms similarly -->
            </div>
        </div>
    </div>

    <script>
        // Templates per i post
        const postTemplates = {
            promo: {
                title: "üéØ Post Promozionale",
                content: "üåü Scopri la nostra ultima offerta! \n\n‚ú® Caratteristiche principali:\n‚Ä¢ [Feature 1]\n‚Ä¢ [Feature 2]\n‚Ä¢ [Feature 3]\n\nüí∞ Offerta limitata - Non perdere questa occasione!\n\n#promo #offerta #limitedtime"
            },
            education: {
                title: "üìö Contenuto Educativo", 
                content: "üí° Lo sapevi che...?\n\nüìñ Oggi parliamo di [ARGOMENTO]\n\nüîç Punti chiave:\n1. [Punto 1]\n2. [Punto 2]\n3. [Punto 3]\n\nüí¨ Cosa ne pensi? Condividi la tua esperienza nei commenti!\n\n#education #tips #learning"
            },
            engagement: {
                title: "üí¨ Post di Engagement",
                content: "ü§î Domanda del giorno!\n\n‚ùì [LA TUA DOMANDA QUI]\n\nA) [Opzione A]\nB) [Opzione B]\nC) [Opzione C]\n\nüí≠ Scrivi la tua risposta nei commenti e tagga un amico!\n\n#poll #question #engagement #community"
            }
        };

        // Funzioni per mostrare/nascondere sezioni
        function showSection(sectionId) {
            console.log('üîç Trying to show section:', sectionId);
            
            // Debug: mostra tutte le sezioni disponibili
            const allSections = document.querySelectorAll('.form-section[id]');
            console.log('üìã Available sections:', Array.from(allSections).map(s => s.id));
            
            // Nascondi tutte le sezioni nascoste
            document.querySelectorAll('.form-section').forEach(el => {
                if (el.id && el.id !== sectionId && !el.classList.contains('hidden')) {
                    // Non nascondere la sezione delle azioni rapide e attivit√† recente
                    if (el.querySelector('h2') && el.querySelector('h2').textContent.includes('Azioni Rapide')) return;
                    if (el.querySelector('h3') && el.querySelector('h3').textContent.includes('Attivit√† Recente')) return;
                    el.classList.add('hidden');
                }
            });
            
            // Mostra la sezione richiesta
            const section = document.getElementById(sectionId);
            console.log('üéØ Found section:', section);
            
            if (section) {
                section.classList.remove('hidden');
                section.scrollIntoView({ behavior: 'smooth' });
                console.log('‚úÖ Section shown successfully:', sectionId);
                
                // Mostra notifica di successo per account-config
                if (sectionId === 'account-config') {
                    showNotification('üéâ Benvenuto nella configurazione account!', 'success');
                }
            } else {
                console.error('‚ùå Section not found:', sectionId);
                // Per debug: mostra un alert se la sezione non viene trovata
                alert(`‚ùå Errore: Sezione '${sectionId}' non trovata. Sezioni disponibili: ${Array.from(allSections).map(s => s.id).join(', ')}`);
            }
            
            // Carica dati specifici per la sezione
            if (sectionId === 'analytics') {
                loadAnalytics();
            } else if (sectionId === 'account-config') {
                loadAccountProfile();
            }
        }

        function hideSection(sectionId) {
            document.getElementById(sectionId).classList.add('hidden');
        }

        // Funzione per caricare template
        function loadTemplate() {
            const templateSelect = document.getElementById('post-template');
            const preview = document.getElementById('template-preview');
            const selectedTemplate = templateSelect.value;

            if (selectedTemplate && postTemplates[selectedTemplate]) {
                const template = postTemplates[selectedTemplate];
                preview.innerHTML = `
                    <div class="bg-white p-4 rounded border">
                        <h4 class="font-medium text-gray-900 mb-2">${template.title}</h4>
                        <div class="text-gray-700 whitespace-pre-line">${template.content}</div>
                    </div>
                `;
            } else if (selectedTemplate === 'custom') {
                preview.innerHTML = `
                    <textarea 
                        rows="6" 
                        class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                        placeholder="Scrivi qui il tuo contenuto personalizzato..."
                        id="custom-content"
                    ></textarea>
                `;
            } else {
                preview.innerHTML = '<span class="text-gray-500">Seleziona un template per vedere l\'anteprima</span>';
            }
        }

        // Funzione per creare post
        async function createPost(event) {
            event.preventDefault();
            
            const content = document.getElementById('post-content').value;
            const platforms = Array.from(document.querySelectorAll('input[name="platforms"]:checked')).map(cb => cb.value);
            const mediaFiles = document.getElementById('media-upload').files;
            
            if (platforms.length === 0) {
                alert('‚ö†Ô∏è Seleziona almeno una piattaforma per pubblicare!');
                return;
            }
            
            // Mostra loading
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Pubblicando...';
            submitBtn.disabled = true;
            
            try {
                // Simula chiamata API
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                alert('‚úÖ Post pubblicato con successo su ' + platforms.join(', ') + '!');
                event.target.reset();
                hideSection('create-post');
                loadRecentActivity();
                
            } catch (error) {
                alert('‚ùå Errore durante la pubblicazione: ' + error.message);
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Funzione per programmare post
        async function schedulePost(event) {
            event.preventDefault();
            
            const datetime = document.getElementById('schedule-datetime').value;
            const template = document.getElementById('post-template').value;
            
            if (!datetime) {
                alert('‚ö†Ô∏è Seleziona data e ora per la programmazione!');
                return;
            }
            
            const scheduleDate = new Date(datetime);
            const now = new Date();
            
            if (scheduleDate <= now) {
                alert('‚ö†Ô∏è La data di programmazione deve essere nel futuro!');
                return;
            }
            
            // Mostra loading
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Programmando...';
            submitBtn.disabled = true;
            
            try {
                // Simula chiamata API
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                alert(`‚úÖ Post programmato per ${scheduleDate.toLocaleString('it-IT')}!`);
                event.target.reset();
                document.getElementById('template-preview').innerHTML = '<span class="text-gray-500">Seleziona un template per vedere l\'anteprima</span>';
                hideSection('schedule-post');
                
            } catch (error) {
                alert('‚ùå Errore durante la programmazione: ' + error.message);
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Funzione per caricare analytics
        async function loadAnalytics() {
            try {
                // Simula caricamento dati analytics
                const mockData = {
                    totalViews: 15420,
                    engagementRate: 4.2,
                    newFollowers: 127
                };
                
                document.getElementById('total-views').textContent = mockData.totalViews.toLocaleString();
                document.getElementById('engagement-rate').textContent = mockData.engagementRate + '%';
                document.getElementById('new-followers').textContent = '+' + mockData.newFollowers;
                
                // Crea grafico engagement
                const ctx = document.getElementById('engagement-chart');
                if (ctx && !ctx.chart) {
                    ctx.chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab', 'Dom'],
                            datasets: [{
                                label: 'Engagement Rate %',
                                data: [3.2, 4.1, 3.8, 4.5, 4.2, 5.1, 3.9],
                                borderColor: '#8B5CF6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 6
                                }
                            }
                        }
                    });
                }
                
                // Carica top posts
                const topPosts = document.getElementById('top-posts');
                topPosts.innerHTML = `
                    <div class="bg-gray-50 p-3 rounded">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Post del 26 Giugno</span>
                            <span class="text-sm font-medium text-green-600">‚Üó 8.2% engagement</span>
                        </div>
                        <p class="text-gray-800 mt-1">Tips per migliorare la tua strategia social...</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Post del 25 Giugno</span>
                            <span class="text-sm font-medium text-green-600">‚Üó 6.7% engagement</span>
                        </div>
                        <p class="text-gray-800 mt-1">Novit√† in arrivo! Resta sintonizzato...</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('Errore nel caricamento analytics:', error);
            }
        }

        // Funzione per caricare attivit√† recente
        function loadRecentActivity() {
            const recentActivity = document.getElementById('recent-activity');
            const now = new Date();
            
            recentActivity.innerHTML = `
                <div class="flex items-center p-3 bg-green-50 rounded-lg">
                    <i class="fas fa-check-circle text-green-600 mr-3"></i>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Post pubblicato con successo</p>
                        <p class="text-xs text-gray-500">${now.toLocaleTimeString('it-IT')} - Facebook, Instagram</p>
                    </div>
                </div>
                <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                    <i class="fas fa-clock text-blue-600 mr-3"></i>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Post programmato</p>
                        <p class="text-xs text-gray-500">Oggi 18:00 - LinkedIn</p>
                    </div>
                </div>
                <div class="flex items-center p-3 bg-yellow-50 rounded-lg">
                    <i class="fas fa-heart text-yellow-600 mr-3"></i>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Nuovo engagement</p>
                        <p class="text-xs text-gray-500">+25 like sul post "Tips per social media"</p>
                    </div>
                </div>
            `;
        }

        // Funzioni per la configurazione account
        async function connectPlatform(platform) {
            const btnId = platform + '-btn';
            const statusId = platform + '-status';
            const btn = document.getElementById(btnId);
            const status = document.getElementById(statusId);
            
            // Mostra loading
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Collegando...';
            btn.disabled = true;
            
            try {
                // Chiama l'API reale per collegare la piattaforma
                const response = await fetch(`/account/connect/${platform}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer demo_token' // In una vera app, questo sarebbe il token JWT dell'utente
                    },
                    body: JSON.stringify({
                        platform: platform,
                        access_token: `demo_${platform}_token_${Date.now()}`,
                        refresh_token: `demo_${platform}_refresh_${Date.now()}`
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    status.textContent = 'Collegato ‚úÖ';
                    status.className = 'text-sm text-green-600';
                    btn.innerHTML = '<i class="fas fa-unlink mr-1"></i>Scollega';
                    btn.className = 'bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 text-sm';
                    btn.onclick = () => disconnectPlatform(platform);
                    
                    showNotification(`‚úÖ ${platform.charAt(0).toUpperCase() + platform.slice(1)} collegato con successo!`, 'success');
                    addRecentActivity(`Collegato account ${platform.charAt(0).toUpperCase() + platform.slice(1)}`, 'connect');
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Errore di connessione');
                }
            } catch (error) {
                status.textContent = 'Errore di connessione ‚ùå';
                status.className = 'text-sm text-red-600';
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                showNotification(`‚ùå Errore nel collegamento di ${platform}: ${error.message}`, 'error');
            }
        }
        
        async function disconnectPlatform(platform) {
            if (!confirm(`Sei sicuro di voler scollegare ${platform}?`)) {
                return;
            }
            
            const btnId = platform + '-btn';
            const statusId = platform + '-status';
            const btn = document.getElementById(btnId);
            const status = document.getElementById(statusId);
            
            try {
                const response = await fetch(`/account/disconnect/${platform}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': 'Bearer demo_token'
                    }
                });
                
                if (response.ok) {
                    status.textContent = 'Non collegato';
                    status.className = 'text-sm text-gray-500';
                    btn.innerHTML = 'Collega';
                    btn.className = getButtonColorClass(platform) + ' text-white px-4 py-2 rounded-md hover:opacity-90 text-sm';
                    btn.onclick = () => connectPlatform(platform);
                    
                    showNotification(`üì¥ ${platform.charAt(0).toUpperCase() + platform.slice(1)} scollegato`, 'info');
                    addRecentActivity(`Scollegato account ${platform.charAt(0).toUpperCase() + platform.slice(1)}`, 'disconnect');
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Errore nella disconnessione');
                }
            } catch (error) {
                showNotification(`‚ùå Errore nella disconnessione di ${platform}: ${error.message}`, 'error');
            }
        }
        
        function getButtonColorClass(platform) {
            const colors = {
                facebook: 'bg-blue-600 hover:bg-blue-700',
                instagram: 'bg-pink-600 hover:bg-pink-700',
                twitter: 'bg-blue-400 hover:bg-blue-500',
                linkedin: 'bg-blue-700 hover:bg-blue-800'
            };
            return colors[platform] || 'bg-gray-600 hover:bg-gray-700';
        }
        
        async function saveAccountSettings(event) {
            event.preventDefault();
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Salvando...';
            submitBtn.disabled = true;
            
            try {
                // Raccogli i dati dal form
                const formData = new FormData(event.target);
                const preferences = {
                    timezone: document.getElementById('timezone').value,
                    language: document.getElementById('language').value,
                    email_notifications: document.querySelector('input[type="checkbox"]:nth-of-type(1)').checked,
                    engagement_alerts: document.querySelector('input[type="checkbox"]:nth-of-type(2)').checked,
                    weekly_reports: document.querySelector('input[type="checkbox"]:nth-of-type(3)').checked,
                    optimization_tips: document.querySelector('input[type="checkbox"]:nth-of-type(4)').checked
                };
                
                // Chiama l'API reale per salvare le preferenze
                const response = await fetch('/account/preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer demo_token'
                    },
                    body: JSON.stringify(preferences)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showNotification('‚úÖ Impostazioni salvate con successo!', 'success');
                    addRecentActivity('Aggiornate impostazioni profilo', 'settings');
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Errore nel salvataggio');
                }
                
            } catch (error) {
                showNotification(`‚ùå Errore nel salvataggio: ${error.message}`, 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }
        
        function showNotification(message, type = 'info') {
            // Crea elemento notifica
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${getNotificationColorClass(type)}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="flex-1">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-lg">√ó</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove dopo 5 secondi
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        function getNotificationColorClass(type) {
            const colors = {
                success: 'bg-green-100 border-green-500 text-green-800 border-l-4',
                error: 'bg-red-100 border-red-500 text-red-800 border-l-4',
                info: 'bg-blue-100 border-blue-500 text-blue-800 border-l-4',
                warning: 'bg-yellow-100 border-yellow-500 text-yellow-800 border-l-4'
            };
            return colors[type] || colors.info;
        }
        
        async function loadAccountProfile() {
            try {
                console.log('üîÑ Caricamento profilo account...');
                
                // Carica il profilo completo
                const response = await fetch('/account/profile', {
                    headers: {
                        'Authorization': 'Bearer demo_token'
                    }
                });
                
                if (response.ok) {
                    const profile = await response.json();
                    console.log('üë§ Profilo caricato:', profile);
                    
                    // Aggiorna i campi del form con i dati del profilo
                    document.getElementById('username').value = profile.username || 'Utente Demo';
                    document.getElementById('email').value = profile.email || 'demo@esempio.com';
                    document.getElementById('timezone').value = profile.preferences.timezone || 'Europe/Rome';
                    document.getElementById('language').value = profile.preferences.language || 'it';
                    
                    // Aggiorna le checkbox delle notifiche
                    const checkboxes = document.querySelectorAll('#account-config input[type="checkbox"]');
                    if (checkboxes[0]) checkboxes[0].checked = profile.preferences.email_notifications;
                    if (checkboxes[1]) checkboxes[1].checked = profile.preferences.engagement_alerts;
                    if (checkboxes[2]) checkboxes[2].checked = profile.preferences.weekly_reports;
                    if (checkboxes[3]) checkboxes[3].checked = profile.preferences.optimization_tips;
                    
                    // Aggiorna lo stato delle piattaforme collegate
                    Object.entries(profile.connected_platforms).forEach(([platform, connected]) => {
                        const statusElement = document.getElementById(`${platform}-status`);
                        const btnElement = document.getElementById(`${platform}-btn`);
                        
                        if (statusElement && btnElement) {
                            if (connected) {
                                statusElement.textContent = 'Collegato ‚úÖ';
                                statusElement.className = 'text-sm text-green-600';
                                btnElement.innerHTML = '<i class="fas fa-unlink mr-1"></i>Scollega';
                                btnElement.className = 'bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 text-sm';
                                btnElement.onclick = () => disconnectPlatform(platform);
                            } else {
                                statusElement.textContent = 'Non collegato';
                                statusElement.className = 'text-sm text-gray-500';
                                btnElement.innerHTML = 'Collega';
                                btnElement.className = getButtonColorClass(platform) + ' text-white px-4 py-2 rounded-md hover:opacity-90 text-sm';
                                btnElement.onclick = () => connectPlatform(platform);
                            }
                        }
                    });
                    
                    showNotification('‚úÖ Profilo caricato con successo', 'success');
                    
                } else {
                    console.error('‚ùå Errore nel caricamento profilo:', response.status);
                    // Usa valori di default se il caricamento fallisce
                    showNotification('‚ö†Ô∏è Usando valori di default. Alcune funzioni potrebbero non essere disponibili.', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Errore nel caricamento profilo:', error);
                showNotification('‚ö†Ô∏è Errore nel caricamento profilo. Usando valori di default.', 'warning');
            }
        }

        function addRecentActivity(action, type) {
            const activities = JSON.parse(localStorage.getItem('recentActivities') || '[]');
            const newActivity = {
                action,
                type,
                timestamp: new Date().toISOString(),
                id: Date.now()
            };
            
            activities.unshift(newActivity);
            activities.splice(10); // Mantieni solo le ultime 10 attivit√†
            
            localStorage.setItem('recentActivities', JSON.stringify(activities));
            loadRecentActivity(); // Ricarica la visualizzazione
        }

        // Inizializza la dashboard al caricamento
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentActivity();
            
            // Imposta la data minima per la programmazione (ora attuale + 1 ora)
            const now = new Date();
            now.setHours(now.getHours() + 1);
            const minDateTime = now.toISOString().slice(0, 16);
            document.getElementById('schedule-datetime').min = minDateTime;
            
            // Controlla se ci sono azioni da eseguire dalla guida
            const dashboardAction = localStorage.getItem('dashboardAction');
            if (dashboardAction) {
                localStorage.removeItem('dashboardAction');
                setTimeout(() => {
                    showSection(dashboardAction);
                }, 500);
            }
        });

        // Controllo stato accesso Facebook
        function statusChangeCallback(response) {
          if (response.status === 'connected') {
            console.log('Utente connesso:', response.authResponse);
            window.location.href = '/dashboard';
          } else if (response.status === 'not_authorized') {
            console.log('Utente non autorizzato.');
            document.getElementById('login-button').style.display = 'block';
          } else {
            console.log('Utente non connesso a Facebook.');
            document.getElementById('login-button').style.display = 'block';
          }
        }

        FB.getLoginStatus(function(response) {
          statusChangeCallback(response);
        });
    </script>

    <!-- Facebook SDK -->
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '717748311231080', // ID dell'app fornito
          cookie     : true,
          xfbml      : true,
          version    : 'v12.0' // Versione API
        });
        FB.AppEvents.logPageView();
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "https://connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
    </script>
</body>
</html>